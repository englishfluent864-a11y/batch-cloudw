name: YouTube Automation - Images & Songs Together

on:
  workflow_dispatch:
  schedule:
    - cron: "35 23 * * *"  # 12:35 AM Sweden time (UTC+1/UTC+2)

jobs:
  run-batch:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set timezone to Stockholm
        run: tzutil /s "W. Europe Standard Time"

      - name: Check both folders and run batch
        shell: powershell
        run: |
          $imageFolder = "${{ github.workspace }}\moneyvidz"
          $songFolder  = "${{ github.workspace }}\pixabaysongs1"

          $images = Get-ChildItem -Path $imageFolder -Include *.jpg,*.png,*.jpeg -File
          $songs  = Get-ChildItem -Path $songFolder -Include *.mp3,*.wav,*.aac -File

          if ($images.Count -eq 0 -or $songs.Count -eq 0) {
              Write-Output "Either moneyvidz or pixabaysongs1 is empty. Skipping batch."
              exit 0
          }

          Write-Output "Both folders have files. Running skkk.bat..."
          & "${{ github.workspace }}\skkk.bat"

          # Move processed images
          $destImages = "$imageFolder\done"
          if (-not (Test-Path $destImages)) { New-Item -ItemType Directory -Path $destImages }
          Move-Item -Path "$imageFolder\*" -Destination $destImages

          # Move processed songs
          $destSongs = "$songFolder\done"
          if (-not (Test-Path $destSongs)) { New-Item -ItemType Directory -Path $destSongs }
          Move-Item -Path "$songFolder\*" -Destination $destSongs
